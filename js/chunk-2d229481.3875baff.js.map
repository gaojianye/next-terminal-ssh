{"version":3,"sources":["webpack:///./src/views/login.vue?614d","webpack:///src/views/login.vue","webpack:///./src/views/login.vue?2a23","webpack:///./src/views/login.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","directives","name","rawName","ref","staticClass","staticStyle","on","handleKeydown","onResize","staticRenderFns","component"],"mappings":"uHAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,WAAW,CAAC,CAACC,KAAK,SAASC,QAAQ,aAAaC,IAAI,QAAQC,YAAY,YAAYC,YAAY,CAAC,OAAS,SAASC,GAAG,CAAC,QAAUZ,EAAIa,cAAc,OAASb,EAAIc,aACtQC,EAAkB,G,oCCatB,GACA,KADA,WAEA,OACA,gBACA,MACA,YACA,YACA,SAEA,OACA,2DACA,2DACA,kEAEA,gBACA,oBACA,kBACA,aACA,UACA,gBAGA,SACA,aADA,SACA,GACA,4CACA,8BACA,wBAEA,OANA,SAMA,GACA,mBAEA,UATA,WASA,WACA,wCACA,oBAEA,2BACA,yBACA,2DACA,YACA,OACA,8BAEA,2BAEA,6BACA,wBACA,sBAEA,iBACA,UACA,oBACA,mBAEA,mCACA,6BACA,2CACA,oEACA,mBAGA,uBAIA,YACA,0DACA,YAEA,sBACA,UACA,SACA,eACA,YACA,aACA,MACA,QACA,YACA,eACA,MACA,QAEA,qBACA,iBACA,cAEA,MACA,QAEA,kBACA,SAEA,gBACA,mBACA,aAEA,eAKA,aAIA,SAlFA,WAmFA,qBAGA,cAtFA,SAsFA,GACA,oEACA,eACA,SAEA,aACA,yCACA,WACA,YACA,YACA,SAEA,mBACA,kBACA,4DACA,uBACA,qBAGA,SAzGA,WAyGA,WACA,kBACA,aACA,gBACA,qDACA,6CACA,uBACA,uBAEA,yDACA,wBAEA,MACA,eACA,gBACA,kCACA,4CACA,uBACA,uBAEA,6CACA,wBAEA,MACA,eACA,gBACA,kCACA,qBACA,WACA,yBACA,kBACA,cAKA,OAJA,kBACA,cACA,0CACA,kBACA,EACA,YACA,qBAGA,kBACA,kBACA,2CACA,sBAGA,4CACA,wBAEA,MACA,WACA,gBACA,8BACA,qBACA,WACA,iCACA,kBACA,YACA,qBAGA,kBACA,kBACA,2CACA,sBAGA,8CACA,wBAGA,mBAEA,SAnLA,WAoLA,oEAEA,WAtLA,SAsLA,GACA,mBAEA,WAzLA,WA0LA,oBAGA,QAnNA,WAoNA,mBClO+U,I,YCO3UC,EAAY,eACd,EACAjB,EACAgB,GACA,EACA,KACA,KACA,MAIa,aAAAC,E","file":"js/chunk-2d229481.3875baff.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{directives:[{name:\"resize\",rawName:\"v-resize\"}],ref:\"xterm\",staticClass:\"xterm-box\",staticStyle:{\"height\":\"100vh\"},on:{\"keydown\":_vm.handleKeydown,\"resize\":_vm.onResize}})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n\t<div\n\t\tstyle=\"height: 100vh;\"\n\t\tclass=\"xterm-box\"\n\t\t@keydown=\"handleKeydown\"\n\t\tv-resize\n\t\t@resize=\"onResize\"\n\t\tref=\"xterm\"\n\t></div>\n</template>\n<script>\nimport \"xterm/css/xterm.css\"\nimport { Terminal } from \"xterm\"\nimport { FitAddon } from \"xterm-addon-fit\"\nexport default {\n\tdata() {\n\t\treturn {\n\t\t\tstep: \"username\",\n\t\t\tform: {\n\t\t\t\tusername: \"\",\n\t\t\t\tpassword: \"\",\n\t\t\t\ttotp: \"\",\n\t\t\t},\n\t\t\trules: {\n\t\t\t\tusername: [{ required: true, message: \"请输入登录账号！\", trigger: \"blur\" }],\n\t\t\t\tpassword: [{ required: true, message: \"请输入登录密码！\", trigger: \"blur\" }],\n\t\t\t\ttotp: [{ required: true, message: \"请输入双因素认证APP中显示的授权码\", trigger: \"blur\" }],\n\t\t\t},\n\t\t\tloginLoading: false,\n\t\t\ttotpModalVisible: false,\n\t\t\tconfirmLoading: false,\n\t\t\ttempValue: \"\",\n\t\t\tterm: null,\n\t\t\tfitAddon: null,\n\t\t}\n\t},\n\tmethods: {\n\t\tloginSuccess(res) {\n\t\t\tlocalStorage.setItem(\"X-Auth-Token\", res.data)\n\t\t\tthis.$message.success(\"登陆成功\")\n\t\t\tthis.$router.push(\"/\")\n\t\t},\n\t\tprompt(term) {\n\t\t\tterm.write(\"\\r\\n$ \")\n\t\t},\n\t\tinitXterm() {\n\t\t\tif (!window.localStorage.getItem(\"apiUrl\")) {\n\t\t\t\tthis.step = \"apiUrl\"\n\t\t\t}\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tconst term = new Terminal({\n\t\t\t\t\tfontFamily: 'monaco, Consolas, \"Lucida Console\", monospace',\n\t\t\t\t\tfontSize: 14,\n\t\t\t\t\ttheme: {\n\t\t\t\t\t\tbackground: \"rgb(40, 44, 52)\",\n\t\t\t\t\t},\n\t\t\t\t\trightClickSelectsWord: true,\n\t\t\t\t})\n\t\t\t\tthis.fitAddon = new FitAddon()\n\t\t\t\tterm.loadAddon(this.fitAddon)\n\t\t\t\tterm.open(this.$refs.xterm)\n\t\t\t\t// 自适应插件\n\t\t\t\tthis.fitAddon.fit()\n\t\t\t\tterm.focus()\n\t\t\t\tterm.prompt = () => {\n\t\t\t\t\tterm.write(\"\\r\\n$ \")\n\t\t\t\t}\n\t\t\t\tterm.writeln(\"欢迎进入Next Terminal ...\")\n\t\t\t\tterm.writeln(\"神奇的功能等待你去发现 ...\")\n\t\t\t\tterm.attachCustomKeyEventHandler((e) => {\n\t\t\t\t\tlet mod = /Mac|iPod|iPhone|iPad/.test(navigator.platform) ? \"meta\" : \"ctrl\"\n\t\t\t\t\tif (!e[mod + \"Key\"]) {\n\t\t\t\t\t\treturn true\n\t\t\t\t\t}\n\t\t\t\t\tif (e.key === \"l\") {\n\t\t\t\t\t\treturn false\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tthis.prompt(term)\n\t\t\t\tterm.write(this.step == \"apiUrl\" ? \"请输入next-terminal后端地址\" : \"请输入用户名\")\n\t\t\t\tthis.prompt(term)\n\n\t\t\t\tterm.onData((e) => {\n\t\t\t\t\tswitch (e) {\n\t\t\t\t\t\tcase \"\\r\": // Enter\n\t\t\t\t\t\t\tconsole.log(1)\n\t\t\t\t\t\t\tthis.prompt(term)\n\t\t\t\t\t\t\tthis.nextStep()\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tcase \"\\u0003\": // Ctrl+C\n\t\t\t\t\t\t\tthis.prompt(term)\n\t\t\t\t\t\t\tthis.emptyValue()\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tcase \"\\u007F\": // Backspace (DEL)\n\t\t\t\t\t\t\t// Do not delete the prompt\n\t\t\t\t\t\t\tif (term._core.buffer.x > 2) {\n\t\t\t\t\t\t\t\tterm.write(\"\\b \\b\")\n\t\t\t\t\t\t\t\tthis.delValue()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t// Print all other characters for demo\n\t\t\t\t\t\t\tif (this.loginLoading) {\n\t\t\t\t\t\t\t\treturn false\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.writeValue(e)\n\t\t\t\t\t\t\tif (this.step == \"password\") {\n\t\t\t\t\t\t\t\tterm.write(\"*\")\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tterm.write(e)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tthis.term = term\n\t\t\t})\n\t\t},\n\n\t\tonResize() {\n\t\t\tthis.fitAddon.fit()\n\t\t},\n\t\t// 注册快捷键 搜索  清屏\n\t\thandleKeydown(e) {\n\t\t\tlet mod = /Mac|iPod|iPhone|iPad/.test(navigator.platform) ? \"meta\" : \"ctrl\"\n\t\t\tif (!e[mod + \"Key\"]) {\n\t\t\t\treturn false\n\t\t\t}\n\t\t\tif (e.key == \"l\") {\n\t\t\t\twindow.localStorage.setItem(\"apiUrl\", \"\")\n\t\t\t\tthis.form = {\n\t\t\t\t\tusername: \"\",\n\t\t\t\t\tpassword: \"\",\n\t\t\t\t\ttotp: \"\",\n\t\t\t\t}\n\t\t\t\tthis.step = \"apiUrl\"\n\t\t\t\tthis.term.clear()\n\t\t\t\tthis.term.write(\"1.请输入next-terminal后端地址 （CTRL + L 清空全部输入）\")\n\t\t\t\tthis.prompt(this.term)\n\t\t\t\te.preventDefault()\n\t\t\t}\n\t\t},\n\t\tnextStep() {\n\t\t\tswitch (this.step) {\n\t\t\t\tcase \"apiUrl\":\n\t\t\t\t\tif (this.tempValue) {\n\t\t\t\t\t\twindow.localStorage.setItem(\"apiUrl\", this.tempValue)\n\t\t\t\t\t\tthis.term.write(\"2.请输入用户名（CTRL + L 清空全部输入）\")\n\t\t\t\t\t\tthis.prompt(this.term)\n\t\t\t\t\t\tthis.step = \"username\"\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.term.write(\"请输入next-terminal后端地址（CTRL + L 清空全部输入）\")\n\t\t\t\t\t\tthis.prompt(this.term)\n\t\t\t\t\t}\n\t\t\t\t\tbreak\n\t\t\t\tcase \"username\":\n\t\t\t\t\tif (this.tempValue) {\n\t\t\t\t\t\tthis.form.username = this.tempValue\n\t\t\t\t\t\tthis.term.write(\"3.请输入密码（CTRL + L 清空全部输入）\")\n\t\t\t\t\t\tthis.prompt(this.term)\n\t\t\t\t\t\tthis.step = \"password\"\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.term.write(\"请确认输入用户名（CTRL + L 清空全部输入）\")\n\t\t\t\t\t\tthis.prompt(this.term)\n\t\t\t\t\t}\n\t\t\t\t\tbreak\n\t\t\t\tcase \"password\":\n\t\t\t\t\tif (this.tempValue) {\n\t\t\t\t\t\tthis.form.password = this.tempValue\n\t\t\t\t\t\tthis.loginLoading = true\n\t\t\t\t\t\tthis.$http\n\t\t\t\t\t\t\t.post(\"/login\", this.form)\n\t\t\t\t\t\t\t.then((res) => {\n\t\t\t\t\t\t\t\tif (res.code === 0) {\n\t\t\t\t\t\t\t\t\tthis.loginLoading = false\n\t\t\t\t\t\t\t\t\tthis.step = \"totp\"\n\t\t\t\t\t\t\t\t\tthis.term.write(\"请输入双因素验证（CTRL + L 清空全部输入）\")\n\t\t\t\t\t\t\t\t\tthis.prompt(this.term)\n\t\t\t\t\t\t\t\t\treturn false\n\t\t\t\t\t\t\t\t} else if (res.code === 1) {\n\t\t\t\t\t\t\t\t\tthis.loginSuccess(res)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\t\t\tthis.loginLoading = false\n\t\t\t\t\t\t\t\tthis.term.write(\"4.请确认输入密码（CTRL + L 清空全部输入）\")\n\t\t\t\t\t\t\t\tthis.prompt(this.term)\n\t\t\t\t\t\t\t})\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.term.write(\"请确认输入密码（CTRL + L 清空全部输入）\")\n\t\t\t\t\t\tthis.prompt(this.term)\n\t\t\t\t\t}\n\t\t\t\t\tbreak\n\t\t\t\tcase \"totp\":\n\t\t\t\t\tif (this.tempValue) {\n\t\t\t\t\t\tthis.form.totp = this.tempValue\n\t\t\t\t\t\tthis.loginLoading = true\n\t\t\t\t\t\tthis.$http\n\t\t\t\t\t\t\t.post(\"/loginWithTotp\", this.form)\n\t\t\t\t\t\t\t.then((res) => {\n\t\t\t\t\t\t\t\tif (res.code === 1) {\n\t\t\t\t\t\t\t\t\tthis.loginSuccess(res)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\t\t\tthis.loginLoading = false\n\t\t\t\t\t\t\t\tthis.term.write(\"请确输入双因素验证（CTRL + L 清空全部输入）\")\n\t\t\t\t\t\t\t\tthis.prompt(this.term)\n\t\t\t\t\t\t\t})\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.term.write(\"请确输入双因素验证（CTRL + L 清空全部输入）\")\n\t\t\t\t\t\tthis.prompt(this.term)\n\t\t\t\t\t}\n\t\t\t}\n\t\t\tthis.tempValue = \"\"\n\t\t},\n\t\tdelValue() {\n\t\t\tthis.tempValue = this.tempValue.substring(0, this.tempValue.length - 1)\n\t\t},\n\t\twriteValue(e) {\n\t\t\tthis.tempValue += e\n\t\t},\n\t\temptyValue() {\n\t\t\tthis.tempValue = \"\"\n\t\t},\n\t},\n\tcreated() {\n\t\tthis.initXterm()\n\t},\n}\n</script>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./login.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./login.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./login.vue?vue&type=template&id=23de6604&\"\nimport script from \"./login.vue?vue&type=script&lang=js&\"\nexport * from \"./login.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}